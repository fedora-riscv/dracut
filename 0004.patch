From e5d60187837a0a6d80f719fd6e9238adcc3ebbb9 Mon Sep 17 00:00:00 2001
From: Harald Hoyer <harald@hoyer.xyz>
Date: Wed, 16 Aug 2017 10:16:55 +0200
Subject: [PATCH] Merge pull request #268 from danimo/ssh_include_nss

ssh-client: Include nss_ libraries
---
 modules.d/95ssh-client/module-setup.sh | 9 +++++++++
 1 file changed, 9 insertions(+)

diff --git a/modules.d/95ssh-client/module-setup.sh b/modules.d/95ssh-client/module-setup.sh
index 2a7e0ee3..672de502 100755
--- a/modules.d/95ssh-client/module-setup.sh
+++ b/modules.d/95ssh-client/module-setup.sh
@@ -63,7 +63,16 @@ inst_sshenv()
 
 # called by dracut
 install() {
+    local _nsslibs
+
     inst_multiple ssh scp
     inst_sshenv
+
+    _nsslibs=$(sed -e '/^#/d' -e 's/^.*://' -e 's/\[NOTFOUND=return\]//' /etc/nsswitch.conf \
+        |  tr -s '[:space:]' '\n' | sort -u | tr -s '[:space:]' '|')
+    _nsslibs=${_nsslibs#|}
+    _nsslibs=${_nsslibs%|}
+
+    inst_libdir_file -n "$_nsslibs" 'libnss_*.so*'
 }
 

