From 5a8f1aef556056de88d55bb398443fe2b57eae52 Mon Sep 17 00:00:00 2001
From: Harald Hoyer <harald@redhat.com>
Date: Thu, 16 Aug 2018 11:59:09 +0200
Subject: [PATCH] TEST-15-BTRFSRAID: sync in test-init

strange failure
---
 test/TEST-15-BTRFSRAID/test-init.sh | 1 +
 test/TEST-15-BTRFSRAID/test.sh      | 3 ++-
 2 files changed, 3 insertions(+), 1 deletion(-)

diff --git a/test/TEST-15-BTRFSRAID/test-init.sh b/test/TEST-15-BTRFSRAID/test-init.sh
index 8f7cdf3a..ab9021df 100755
--- a/test/TEST-15-BTRFSRAID/test-init.sh
+++ b/test/TEST-15-BTRFSRAID/test-init.sh
@@ -2,6 +2,7 @@
 export PATH=/sbin:/bin:/usr/sbin:/usr/bin
 exec >/dev/console 2>&1
 echo "dracut-root-block-success" >/dev/sda1
+sync
 export TERM=linux
 export PS1='initramfs-test:\w\$ '
 [ -f /etc/fstab ] || ln -s /proc/mounts /etc/fstab
diff --git a/test/TEST-15-BTRFSRAID/test.sh b/test/TEST-15-BTRFSRAID/test.sh
index b8969863..3936ade2 100755
--- a/test/TEST-15-BTRFSRAID/test.sh
+++ b/test/TEST-15-BTRFSRAID/test.sh
@@ -15,6 +15,7 @@ test_run() {
 	-append "panic=1 root=LABEL=root rw rd.retry=3 rd.info console=ttyS0,115200n81 selinux=0 rd.shell=0 $DEBUGFAIL" \
 	-initrd $TESTDIR/initramfs.testing
     dd if=$DISKIMAGE bs=512 count=4 skip=2048 | grep -F -m 1 -q dracut-root-block-success $DISKIMAGE || return 1
+    return 0
 }
 
 test_setup() {
@@ -38,7 +39,7 @@ test_setup() {
             mkdir -p -- var/lib/nfs/rpc_pipefs
         )
 	inst_multiple sh df free ls shutdown poweroff stty cat ps ln ip \
-	    mount dmesg dhclient mkdir cp ping dhclient
+	    mount dmesg dhclient mkdir cp ping dhclient sync
         for _terminfodir in /lib/terminfo /etc/terminfo /usr/share/terminfo; do
 	    [ -f ${_terminfodir}/l/linux ] && break
 	done

