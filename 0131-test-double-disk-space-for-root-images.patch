From b93bde235c17e7aa730b928eaf6de1dbeaaf1fb2 Mon Sep 17 00:00:00 2001
From: Harald Hoyer <harald@redhat.com>
Date: Thu, 23 Sep 2010 16:06:53 +0200
Subject: [PATCH 131/133] test: double disk space for root images

---
 test/TEST-11-LVM/create-root.sh      |    8 ++++----
 test/TEST-11-LVM/test.sh             |    2 +-
 test/TEST-12-RAID-DEG/create-root.sh |    8 ++++----
 test/TEST-12-RAID-DEG/test.sh        |    2 +-
 test/TEST-14-IMSM/create-root.sh     |   17 +++++++++--------
 5 files changed, 19 insertions(+), 18 deletions(-)

diff --git a/test/TEST-11-LVM/create-root.sh b/test/TEST-11-LVM/create-root.sh
index c569cd4..357c481 100755
--- a/test/TEST-11-LVM/create-root.sh
+++ b/test/TEST-11-LVM/create-root.sh
@@ -6,11 +6,11 @@ done
 rm /etc/lvm/lvm.conf
 udevadm control --reload-rules
 # save a partition at the beginning for future flagging purposes
-sfdisk -C 640 -H 2 -S 32 -L /dev/sda <<EOF
+sfdisk -C 1280 -H 2 -S 32 -L /dev/sda <<EOF
 ,1
-,213
-,213
-,213
+,400
+,400
+,400
 EOF
 for i in sda2 sda3 sda4; do
 lvm pvcreate -ff  -y /dev/$i ;
diff --git a/test/TEST-11-LVM/test.sh b/test/TEST-11-LVM/test.sh
index 849aeb1..0b6d020 100755
--- a/test/TEST-11-LVM/test.sh
+++ b/test/TEST-11-LVM/test.sh
@@ -16,7 +16,7 @@ test_run() {
 
 test_setup() {
     # Create the blank file to use as a root filesystem
-    dd if=/dev/zero of=root.ext2 bs=1M count=20
+    dd if=/dev/zero of=root.ext2 bs=1M count=40
 
     kernel=$KVERSION
     # Create what will eventually be our root filesystem onto an overlay
diff --git a/test/TEST-12-RAID-DEG/create-root.sh b/test/TEST-12-RAID-DEG/create-root.sh
index 6a2988d..ec1f067 100755
--- a/test/TEST-12-RAID-DEG/create-root.sh
+++ b/test/TEST-12-RAID-DEG/create-root.sh
@@ -6,11 +6,11 @@ done
 rm /etc/lvm/lvm.conf
 udevadm control --reload-rules
 # save a partition at the beginning for future flagging purposes
-sfdisk -C 640 -H 2 -S 32 -L /dev/sda <<EOF
+sfdisk -C 1280 -H 2 -S 32 -L /dev/sda <<EOF
 ,1
-,213
-,213
-,213
+,400
+,400
+,400
 EOF
 mdadm --create /dev/md0 --run --auto=yes --level=5 --raid-devices=3 /dev/sda2 /dev/sda3 /dev/sda4
 # wait for the array to finish initailizing, otherwise this sometimes fails
diff --git a/test/TEST-12-RAID-DEG/test.sh b/test/TEST-12-RAID-DEG/test.sh
index 37f5891..32d9bf5 100755
--- a/test/TEST-12-RAID-DEG/test.sh
+++ b/test/TEST-12-RAID-DEG/test.sh
@@ -51,7 +51,7 @@ test_run() {
 
 test_setup() {
     # Create the blank file to use as a root filesystem
-    dd if=/dev/zero of=root.ext2 bs=1M count=20
+    dd if=/dev/zero of=root.ext2 bs=1M count=40
  
     kernel=$KVERSION
     # Create what will eventually be our root filesystem onto an overlay
diff --git a/test/TEST-14-IMSM/create-root.sh b/test/TEST-14-IMSM/create-root.sh
index 05006c9..ce3fafe 100755
--- a/test/TEST-14-IMSM/create-root.sh
+++ b/test/TEST-14-IMSM/create-root.sh
@@ -22,19 +22,20 @@ for s in $SETS; do
 done
 
 udevadm settle
-
+sfdisk -g /dev/mapper/isw*Test0 
 # save a partition at the beginning for future flagging purposes
-sfdisk -H 255 -S 63 -L /dev/mapper/isw*Test0 <<EOF
-,1
-,1
+sfdisk -C 1280 -H 2 -S 32 -L /dev/mapper/isw*Test0 <<EOF
 ,1
-,
+,300
+,300
+,300
 EOF
+
 udevadm settle
 dmraid -a n
 udevadm settle
 
-SETS=$(dmraid -c -s)
+SETS=$(dmraid -c -s -i)
 # scan and activate all DM RAIDS
 for s in $SETS; do
    dmraid -ay -i -p --rm_partitions "$s" 
@@ -44,9 +45,9 @@ done
 udevadm settle
 
 mdadm --create /dev/md0 --run --auto=yes --level=5 --raid-devices=3 \
-	/dev/mapper/isw*p1 \
 	/dev/mapper/isw*p2 \
-	/dev/mapper/isw*p3 
+	/dev/mapper/isw*p3 \
+	/dev/mapper/isw*p4 
 
 # wait for the array to finish initailizing, otherwise this sometimes fails
 # randomly.
-- 
1.7.3

