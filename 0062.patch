From 9c034dc326b4acd8e66af15f76f151311a5408bb Mon Sep 17 00:00:00 2001
From: Harald Hoyer <harald@redhat.com>
Date: Thu, 16 Aug 2018 11:57:30 +0200
Subject: [PATCH] travis: no rpm check for all matrix tests

---
 .travis.yml    | 10 +++++-----
 fedora-test.sh | 24 ++++++++++++++----------
 2 files changed, 19 insertions(+), 15 deletions(-)

diff --git a/.travis.yml b/.travis.yml
index dfb4a616..075cbc6a 100644
--- a/.travis.yml
+++ b/.travis.yml
@@ -4,12 +4,12 @@ services:
 - docker
 env:
   matrix:
-  - IMAGE=latest  TESTS="01 02 03 04 10 11"
-  - IMAGE=latest  TESTS="12 13 15 17 18"
+  - IMAGE=latest
+  - IMAGE=latest  TESTS="01 02 03 04 10 11 12"
+  - IMAGE=latest  TESTS="13 15 17 18"
   - IMAGE=latest  TESTS=20
-  - IMAGE=latest  TESTS="30 31"
-  - IMAGE=latest  TESTS=50
-  - IMAGE=latest  TESTS="70 99"
+  - IMAGE=latest  TESTS="30 31 99"
+  - IMAGE=latest  TESTS="50 70"
 
 before_script:
   - docker pull fedora:$IMAGE
diff --git a/fedora-test.sh b/fedora-test.sh
index af38bc33..87023a84 100755
--- a/fedora-test.sh
+++ b/fedora-test.sh
@@ -45,13 +45,17 @@ dnf -y install --best --allowerasing \
 
 NCPU=$(getconf _NPROCESSORS_ONLN)
 
-make -j$NCPU all syncheck rpm logtee
-
-cd test
-
-time sudo make \
-     KVERSION=$(rpm -qa kernel --qf '%{VERSION}-%{RELEASE}.%{ARCH}\n' | sort -rn | head -1) \
-     TEST_RUN_ID=$RUN_ID \
-     ${TESTS:+TESTS="$TESTS"} \
-     -k V=2 \
-     check
+if ! [[ $TESTS ]]; then
+    make -j$NCPU all syncheck rpm logtee
+else
+    make -j$NCPU all logtee
+
+    cd test
+
+    time sudo make \
+         KVERSION=$(rpm -qa kernel --qf '%{VERSION}-%{RELEASE}.%{ARCH}\n' | sort -rn | head -1) \
+         TEST_RUN_ID=$RUN_ID \
+         ${TESTS:+TESTS="$TESTS"} \
+         -k V=2 \
+         check
+fi

