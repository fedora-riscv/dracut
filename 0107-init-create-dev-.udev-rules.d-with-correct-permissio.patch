From dfcd238846d578621fd099631ecece90a40e7aef Mon Sep 17 00:00:00 2001
From: Harald Hoyer <harald@redhat.com>
Date: Mon, 2 Aug 2010 15:58:48 +0200
Subject: [PATCH 107/133] init: create /dev/.udev/rules.d with correct permissions

---
 .../90dmsquash-live/dmsquash-live-genrules.sh      |    1 -
 modules.d/95resume/resume-genrules.sh              |    1 -
 modules.d/95rootfs-block/block-genrules.sh         |    1 -
 modules.d/99base/init                              |    2 ++
 4 files changed, 2 insertions(+), 3 deletions(-)

diff --git a/modules.d/90dmsquash-live/dmsquash-live-genrules.sh b/modules.d/90dmsquash-live/dmsquash-live-genrules.sh
index 5e5b27b..c2aee3a 100644
--- a/modules.d/90dmsquash-live/dmsquash-live-genrules.sh
+++ b/modules.d/90dmsquash-live/dmsquash-live-genrules.sh
@@ -1,5 +1,4 @@
 if [ "${root%%:*}" = "live" ]; then
-    [ -d /dev/.udev/rules.d ] || mkdir -m 0755 -p /dev/.udev/rules.d
     {
     printf 'KERNEL=="%s", SYMLINK+="live"\n' \
     	${root#live:/dev/} 
diff --git a/modules.d/95resume/resume-genrules.sh b/modules.d/95resume/resume-genrules.sh
index 91e8a20..a2718b3 100644
--- a/modules.d/95resume/resume-genrules.sh
+++ b/modules.d/95resume/resume-genrules.sh
@@ -1,5 +1,4 @@
 if [ -n "$resume" ]; then
-    [ -d /dev/.udev/rules.d ] || mkdir -m 0755 -p /dev/.udev/rules.d
     {
     printf "KERNEL==\"%s\", ACTION==\"add|change\", SYMLINK+=\"/dev/resume\"\n" \
 		${resume#/dev/};
diff --git a/modules.d/95rootfs-block/block-genrules.sh b/modules.d/95rootfs-block/block-genrules.sh
index 2d9fc43..caafb65 100644
--- a/modules.d/95rootfs-block/block-genrules.sh
+++ b/modules.d/95rootfs-block/block-genrules.sh
@@ -1,5 +1,4 @@
 if [ "${root%%:*}" = "block" ]; then
-    [ -d /dev/.udev/rules.d ] || mkdir -m 0755 -p /dev/.udev/rules.d
     {
     printf 'KERNEL=="%s", SYMLINK+="root"\n' \
 	${root#block:/dev/} 
diff --git a/modules.d/99base/init b/modules.d/99base/init
index 45033af..12153b4 100755
--- a/modules.d/99base/init
+++ b/modules.d/99base/init
@@ -102,6 +102,8 @@ mkdir /dev/shm
 mkdir /dev/pts
 mount -t devpts -o gid=5,mode=620 devpts /dev/pts >/dev/null 2>&1
 mount -t tmpfs tmpfs /dev/shm >/dev/null 2>&1
+mkdir -m 0755 /dev/.udev
+mkdir -m 0755 /dev/.udev/rules.d
 
 UDEVVERSION=$(udevadm --version)
 
-- 
1.7.3

