From 84eafb064490c618c920db186e74f1f9927e0380 Mon Sep 17 00:00:00 2001
From: Harald Hoyer <harald@redhat.com>
Date: Wed, 6 Jun 2012 11:14:48 +0200
Subject: [PATCH] removed setsid and util-linux >= 2.21 requirement

---
 dracut.spec                      |    4 ++--
 modules.d/99base/dracut-lib.sh   |    3 +--
 modules.d/99base/module-setup.sh |    2 +-
 3 files changed, 4 insertions(+), 5 deletions(-)

diff --git a/dracut.spec b/dracut.spec
index e762fdc..54e8d99 100644
--- a/dracut.spec
+++ b/dracut.spec
@@ -78,9 +78,9 @@ Requires: module-init-tools >= 3.7-9
 Requires: sed
 Requires: udev > 166
 %if 0%{?fedora} || 0%{?rhel} > 6
-Requires: util-linux >= 2.21
+Requires: util-linux >= 2.20
 %else
-Requires: util-linux-ng >= 2.21
+Requires: util-linux-ng >= 2.20
 %endif
 
 %if 0%{?fedora} || 0%{?rhel} > 6
diff --git a/modules.d/99base/dracut-lib.sh b/modules.d/99base/dracut-lib.sh
index 4f2b8cd..3ad5000 100755
--- a/modules.d/99base/dracut-lib.sh
+++ b/modules.d/99base/dracut-lib.sh
@@ -798,8 +798,7 @@ emergency_shell()
             _ctty=/dev/$_ctty
         fi
         [ -c "$_ctty" ] || _ctty=/dev/tty1
-        strstr "$(setsid --help 2>/dev/null)" "ctty" && CTTY="-c"
-        setsid $CTTY /bin/sh -i -l 0<$_ctty 1>$_ctty 2>&1
+        /bin/sh -i -l 0<$_ctty 1>$_ctty 2>&1
     else
         warn "$action has failed. To debug this issue add \"rd.shell\" to the kernel command line."
         # cause a kernel panic
diff --git a/modules.d/99base/module-setup.sh b/modules.d/99base/module-setup.sh
index 581ba93..98742f5 100755
--- a/modules.d/99base/module-setup.sh
+++ b/modules.d/99base/module-setup.sh
@@ -14,7 +14,7 @@ depends() {
 install() {
     local _d
     dracut_install mount mknod mkdir modprobe pidof sleep chroot \
-        sed ls flock cp mv dmesg rm ln rmmod mkfifo umount readlink setsid
+        sed ls flock cp mv dmesg rm ln rmmod mkfifo umount readlink
     dracut_install -o less
     if [ ! -e "${initdir}/bin/sh" ]; then
         dracut_install bash
