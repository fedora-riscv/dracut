From 0a1ddd3fd3754c68bd5256e4b87b6978863efa31 Mon Sep 17 00:00:00 2001
From: Harald Hoyer <harald@redhat.com>
Date: Fri, 1 Jun 2012 17:09:25 +0200
Subject: [PATCH] fix return value of some installkernel() functions

---
 modules.d/40network/module-setup.sh   |    3 +++
 modules.d/90multipath/module-setup.sh |    3 +++
 2 files changed, 6 insertions(+)

diff --git a/modules.d/40network/module-setup.sh b/modules.d/40network/module-setup.sh
index c2ad815..e32eb28 100755
--- a/modules.d/40network/module-setup.sh
+++ b/modules.d/40network/module-setup.sh
@@ -27,6 +27,7 @@ installkernel() {
     net_module_filter() {
         local _net_drivers='eth_type_trans|register_virtio_device'
         local _unwanted_drivers='/(wireless|isdn|uwb)/'
+        local _ret
         # subfunctions inherit following FDs
         local _merge=8 _side2=9
         function nmf1() {
@@ -55,7 +56,9 @@ installkernel() {
         # Use two parallel streams to filter alternating modules.
         set +x
         eval "( ( rotor ) ${_side2}>&1 | nmf1 ) ${_merge}>&1"
+        _ret=$?
         [[ $debug ]] && set -x
+        return $_ret
     }
 
     { find_kernel_modules_by_path drivers/net; find_kernel_modules_by_path drivers/s390/net; } \
diff --git a/modules.d/90multipath/module-setup.sh b/modules.d/90multipath/module-setup.sh
index 2f6b416..43057f3 100755
--- a/modules.d/90multipath/module-setup.sh
+++ b/modules.d/90multipath/module-setup.sh
@@ -31,6 +31,7 @@ depends() {
 }
 
 installkernel() {
+    local _ret
     set +x
     mp_mod_filter() {
         local _mpfuncs='scsi_register_device_handler|dm_dirty_log_type_register|dm_register_path_selector|dm_register_target'
@@ -45,7 +46,9 @@ installkernel() {
 
     ( find_kernel_modules_by_path drivers/scsi; find_kernel_modules_by_path drivers/s390/scsi ;
       find_kernel_modules_by_path drivers/md )  |  mp_mod_filter  |  instmods
+    _ret=$?
     [[ $debug ]] && set -x
+    return $_ret
 }
 
 install() {
