From 99a1f385e06e4ea4c1ecfa7d36e3e0d51878ca71 Mon Sep 17 00:00:00 2001
From: Frederick Grose <fgrose@gmail.com>
Date: Thu, 6 Sep 2012 10:48:37 +0200
Subject: [PATCH] dmsquash-live/dmsquash-live-root.sh: Physically write
 overlay reset at time of request

---
 modules.d/90dmsquash-live/dmsquash-live-root.sh | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/modules.d/90dmsquash-live/dmsquash-live-root.sh b/modules.d/90dmsquash-live/dmsquash-live-root.sh
index fdbd6f5..ec84b32 100755
--- a/modules.d/90dmsquash-live/dmsquash-live-root.sh
+++ b/modules.d/90dmsquash-live/dmsquash-live-root.sh
@@ -99,7 +99,7 @@ do_live_overlay() {
         if [ -f /run/initramfs/overlayfs$pathspec -a -w /run/initramfs/overlayfs$pathspec ]; then
             losetup $OVERLAY_LOOPDEV /run/initramfs/overlayfs$pathspec
             if [ -n "$reset_overlay" ]; then
-                dd if=/dev/zero of=$OVERLAY_LOOPDEV bs=64k count=1 2>/dev/null
+                dd if=/dev/zero of=$OVERLAY_LOOPDEV bs=64k count=1 conv=fsync 2>/dev/null
             fi
             setup="yes"
         fi
