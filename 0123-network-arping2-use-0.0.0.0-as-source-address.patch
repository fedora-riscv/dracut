From 5d59890a3c82e07172324c227a54fce1fc6200f4 Mon Sep 17 00:00:00 2001
From: Harald Hoyer <harald@redhat.com>
Date: Mon, 22 Aug 2016 14:38:54 +0200
Subject: [PATCH] network: arping2 use 0.0.0.0 as source address

---
 modules.d/40network/dhclient-script.sh | 2 +-
 modules.d/40network/ifup.sh            | 2 +-
 2 files changed, 2 insertions(+), 2 deletions(-)

diff --git a/modules.d/40network/dhclient-script.sh b/modules.d/40network/dhclient-script.sh
index 2eade353..f49cdb88 100755
--- a/modules.d/40network/dhclient-script.sh
+++ b/modules.d/40network/dhclient-script.sh
@@ -160,7 +160,7 @@ case $reason in
         fi
         if [ "$layer2" != "0" ]; then
             if command -v arping2 >/dev/null; then
-                if arping2 -q -C 1 -c 2 -I $netif $new_ip_address ; then
+                if arping2 -q -C 1 -c 2 -I $netif -0 $new_ip_address ; then
                     warn "Duplicate address detected for $new_ip_address while doing dhcp. retrying"
                     exit 1
                 fi
diff --git a/modules.d/40network/ifup.sh b/modules.d/40network/ifup.sh
index 1461b916..80511562 100755
--- a/modules.d/40network/ifup.sh
+++ b/modules.d/40network/ifup.sh
@@ -111,7 +111,7 @@ do_static() {
         wait_for_ipv6_dad $netif
     else
         if command -v arping2 >/dev/null; then
-            if arping2 -q -C 1 -c 2 -I $netif $ip ; then
+            if arping2 -q -C 1 -c 2 -I $netif -0 $ip ; then
                 warn "Duplicate address detected for $ip for interface $netif."
                 return 1
             fi
