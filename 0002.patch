From c17ad59c49fcc953e65f18c4d7567f001ff8e904 Mon Sep 17 00:00:00 2001
From: Harald Hoyer <harald@redhat.com>
Date: Tue, 10 Oct 2017 10:30:44 +0200
Subject: [PATCH] dracut.sh: if /boot/vmlinuz-$version exists use /boot/ as
 output dir

Fixes https://bugzilla.redhat.com/show_bug.cgi?id=1475565

(cherry picked from commit 791d80168994f4784569c8ea47b7bff554102f5e)
---
 dracut.sh | 4 +++-
 1 file changed, 3 insertions(+), 1 deletion(-)

diff --git a/dracut.sh b/dracut.sh
index 3a136d46..88a4de2b 100755
--- a/dracut.sh
+++ b/dracut.sh
@@ -761,7 +761,9 @@ if ! [[ $outfile ]]; then
         mkdir -p "$efidir/Linux"
         outfile="$efidir/Linux/linux-$kernel${MACHINE_ID:+-${MACHINE_ID}}${BUILD_ID:+-${BUILD_ID}}.efi"
     else
-        if [[ $MACHINE_ID ]] && ( [[ -d /boot/${MACHINE_ID} ]] || [[ -L /boot/${MACHINE_ID} ]] ); then
+        if [[ -e "/boot/vmlinuz-$kernel" ]]; then
+            outfile="/boot/initramfs-$kernel.img"
+        elif [[ $MACHINE_ID ]] && ( [[ -d /boot/${MACHINE_ID} ]] || [[ -L /boot/${MACHINE_ID} ]] ); then
             outfile="/boot/${MACHINE_ID}/$kernel/initrd"
         else
             outfile="/boot/initramfs-$kernel.img"

