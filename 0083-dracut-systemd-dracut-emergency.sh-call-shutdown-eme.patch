From 8fce2c4d5eb6f48fdb2429cf1854aca3ced42423 Mon Sep 17 00:00:00 2001
From: Harald Hoyer <harald@redhat.com>
Date: Tue, 7 Jun 2016 14:47:27 +0200
Subject: [PATCH] dracut-systemd/dracut-emergency.sh: call shutdown-emergency
 hooks

if no rd.shell is given
---
 modules.d/98dracut-systemd/dracut-emergency.sh | 5 +++--
 1 file changed, 3 insertions(+), 2 deletions(-)

diff --git a/modules.d/98dracut-systemd/dracut-emergency.sh b/modules.d/98dracut-systemd/dracut-emergency.sh
index 26be291..63311c2 100755
--- a/modules.d/98dracut-systemd/dracut-emergency.sh
+++ b/modules.d/98dracut-systemd/dracut-emergency.sh
@@ -12,10 +12,9 @@ type plymouth >/dev/null 2>&1 && plymouth quit
 
 export _rdshell_name="dracut" action="Boot" hook="emergency"
 
-source_hook "$hook"
-
 
 if getargbool 1 rd.shell -d -y rdshell || getarg rd.break -d rdbreak; then
+    source_hook "$hook"
     echo
     rdsosreport
     echo
@@ -30,7 +29,9 @@ if getargbool 1 rd.shell -d -y rdshell || getarg rd.break -d rdbreak; then
     [ -z "$PS1" ] && export PS1="$_name:\${PWD}# "
     exec sh -i -l
 else
+    export hook="shutdown-emergency"
     warn "$action has failed. To debug this issue add \"rd.shell rd.debug\" to the kernel command line."
+    source_hook "$hook"
     exit 1
 fi
 
