From 1358efd4f100c72c50bbde92da0bb244d89c3511 Mon Sep 17 00:00:00 2001
From: Harald Hoyer <harald@redhat.com>
Date: Mon, 7 Nov 2011 09:37:55 +0100
Subject: [PATCH] 90kernel-modules/module-setup.sh: include usb mass storage
 drivers

backport of commit e696ade15d9284fc6e3499a69a9b389587430a34
---
 modules.d/90kernel-modules/module-setup.sh |    7 +------
 1 files changed, 1 insertions(+), 6 deletions(-)

diff --git a/modules.d/90kernel-modules/module-setup.sh b/modules.d/90kernel-modules/module-setup.sh
index 9fc4248..0252502 100755
--- a/modules.d/90kernel-modules/module-setup.sh
+++ b/modules.d/90kernel-modules/module-setup.sh
@@ -4,13 +4,8 @@
 
 installkernel() {
     if [[ -z $drivers ]]; then
-        block_module_test() {
-            local blockfuncs='ahci_init_controller|ata_scsi_ioctl|scsi_add_host|blk_init_queue|register_mtd_blktrans|scsi_esp_register|register_virtio_device'
-
-            egrep -q "$blockfuncs" "$1"
-        }
         block_module_filter() {
-            local _blockfuncs='ahci_init_controller|ata_scsi_ioctl|scsi_add_host|blk_init_queue|register_mtd_blktrans|scsi_esp_register|register_virtio_device'
+            local _blockfuncs='ahci_init_controller|ata_scsi_ioctl|scsi_add_host|blk_init_queue|register_mtd_blktrans|scsi_esp_register|register_virtio_device|usb_stor_disconnect'
             local _f
             while read _f; do case "$_f" in
                 *.ko)    [[ $(<         $_f) =~ $_blockfuncs ]] && echo "$_f" ;;
