From 0837829c7b8454cf3d8a991a3605ad5a193fc505 Mon Sep 17 00:00:00 2001
From: Harald Hoyer <harald@redhat.com>
Date: Mon, 23 Jan 2012 11:53:25 +0100
Subject: [PATCH] Revert "90mdraid: wait for md devices to become clean"

This reverts commit e8afcd2b866da7f1af56d5ccaa395eec6500f135.
---
 modules.d/90mdraid/mdraid-waitclean.sh |   25 -------------------------
 modules.d/90mdraid/module-setup.sh     |    1 -
 2 files changed, 26 deletions(-)
 delete mode 100755 modules.d/90mdraid/mdraid-waitclean.sh

diff --git a/modules.d/90mdraid/mdraid-waitclean.sh b/modules.d/90mdraid/mdraid-waitclean.sh
deleted file mode 100755
index c062fc7..0000000
--- a/modules.d/90mdraid/mdraid-waitclean.sh
+++ /dev/null
@@ -1,25 +0,0 @@
-#!/bin/sh
-# -*- mode: shell-script; indent-tabs-mode: nil; sh-basic-offset: 4; -*-
-# ex: ts=8 sw=4 sts=4 et filetype=sh
-
-type getarg >/dev/null 2>&1 || . /lib/dracut-lib.sh
-
-containers=""
-for md in /dev/md[0-9_]*; do
-    [ -b "$md" ] || continue
-    udevinfo="$(udevadm info --query=env --name=$md)"
-    strstr "$udevinfo" "DEVTYPE=partition" && continue
-    if strstr "$udevinfo" "MD_LEVEL=container"; then
-        containers="$containers $md"
-        continue
-    fi
-    info "Waiting for $md to become clean"
-    mdadm -W "$md" >/dev/null 2>&1
-done
-
-for md in $containers; do
-    info "Waiting for $md to become clean"
-    mdadm -W "$md" >/dev/null 2>&1
-done
-
-unset containers udevinfo
diff --git a/modules.d/90mdraid/module-setup.sh b/modules.d/90mdraid/module-setup.sh
index 029d667..fe793bb 100755
--- a/modules.d/90mdraid/module-setup.sh
+++ b/modules.d/90mdraid/module-setup.sh
@@ -83,7 +83,6 @@ install() {
     inst "$moddir/mdraid_start.sh" /sbin/mdraid_start
     inst "$moddir/mdadm_auto.sh" /sbin/mdadm_auto
     inst_hook pre-trigger 30 "$moddir/parse-md.sh"
-    inst_hook pre-mount 10 "$moddir/mdraid-waitclean.sh"
     inst "$moddir/mdraid-cleanup.sh" /sbin/mdraid-cleanup
     inst_hook shutdown 30 "$moddir/md-shutdown.sh"
 }
